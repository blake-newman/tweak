(function(){var t,e=[].slice,n=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty,o=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t,e,n){this.require=e,this.$=n,i=t,this.pTweak=i.Tweak}var r,i,l,s,a,u;return i=null,t.prototype["extends"]=n,t.prototype.bind=o,t.prototype["super"]=function(){var t,n,r,o;return t=arguments[0],o=arguments[1],n=arguments[2],r=4<=arguments.length?e.call(arguments,3):[],t.__super__[n].apply(o,r)},t.prototype.noConflict=function(){return this.pTweak&&(i.Tweak=this.pTweak),this},t.prototype.clone=function(t,e){var n,r,o;if(null==t||"object"!=typeof t||t===e)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return r="",null!=t.global&&(r+="g"),null!=t.ignoreCase&&(r+="i"),null!=t.multiline&&(r+="m"),null!=t.sticky&&(r+="y"),new RegExp(t.source,r);n=t instanceof Array?[]:{};for(o in t)t.hasOwnProperty(o)&&(n[o]=this.clone(t[o],t));return n},t.prototype.combine=function(t,e){var n,r;for(n in e)r=e[n],"object"==typeof r?(null==t[n]&&(t[n]=r instanceof Array?[]:{}),t[n]=this.combine(t[n],r)):t[n]=r;return t},t.prototype.request=function(t,e,n){var r,o,i,l,s;for("string"==typeof t?t=[t]:0===t.length&&(t[0]=""),l=0,s=t.length;s>l;l++){r=t[l];try{return this.require(tweak.toAbsolute(r,e))}catch(i){if(o=i,"Error"!==o.name)throw o}}if(null!=n)return n;throw new Error("No module "+e+" for "+t[0])},a=/^(.*)\[(\d*)(?:[,\-](\d*)){0,1}\](.*)$/,t.prototype.splitPaths=function(t){var e,n,r,o,i,l,s,u,c,p,h,f,g;for("string"==typeof t&&(t=t.split(/\s+/)),f=[],e=0,r=t.length;r>e;e++)if(u=t[e],o=a.exec(u),null!=o)for(u=o[0],c=o[1],l=o[2],i=o[3],g=o[4],s=n=p=null==i?0:l,h=i||l;h>=p?h>=n:n>=h;s=h>=p?++n:--n)f.push(""+c+s+g);else f.push(u);return f},r=/^(\.+[\/\\]+)+/,u=/(\.{2,}[\/\\]+)/g,l=/^(~+[\/\\]+)/,s=/[\/\\]+/g,t.prototype.toAbsolute=function(t,e){var n,o,i;return e=e.replace(s,"/"),t=t.replace(s,"/"),e.match(l)?e.replace(l,"").replace(r,""):(n=(null!=(i=e.match(u))?i.length:void 0)||0,o=RegExp("([\\/\\\\]*[^\\/\\\\]+){"+n+"}[\\/\\\\]?$"),e=e.replace(r,t.replace(o,"")+"/"),e.replace(/^[\/\\]+/,""))},t}(),t=function(){var e,n,r,o,i,l,s;if(s="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||window,"undefined"!=typeof n){for(l=["jquery","zepto","ender","$"],o=0,i=l.length;i>o;o++)if(r=l[o],!e)try{e=s.require(r)}catch(a){}return"undefined"!=typeof module&&null!==module?module.exports=n=new t(s,s.require,e||s.$):void 0}return s.tweak=s.Tweak=new t(s,s.require,s.jQuery||s.Zepto||s.ender||s.$)}(),t.Events=function(){function t(){}return t.prototype.__constructor=function(){},t.prototype.findEvent=function(t,e){var n,r,o,i,l,s;for(null==e&&(e=!1),"string"==typeof t&&(t=t.split(/\s+/)),r=this.__events=this.__events||{},s=[],o=0,i=t.length;i>o;o++){if(l=t[o],!(n=r[l])){if(!e)continue;n=this.__events[l]={name:l,__callbacks:[]}}s.push(n)}return s},t.prototype.addEvent=function(t,e,n,r){var o,i,l,s,a,u,c,p,h,f;for(null==n&&(n=this),("number"==typeof n||null==n)&&(null==r&&(r=this),c=[n,r],r=c[0],n=c[1]),p=this.findEvent(t,!0),l=0,a=p.length;a>l;l++){for(o=p[l],f=!0,h=o.__callbacks,s=0,u=h.length;u>s;s++)i=h[s],i.callback===e&&n===i.context&&(i.max=null!=r?r:i.max,i.calls=0,i.listen=!(f=!1));f&&o.__callbacks.push({context:n,callback:e,max:r,calls:0,listen:!0})}},t.prototype.removeEvent=function(t){var e,n,r,o,i,l,s,a,u,c,p,h,f;for(e=arguments.length>=2?arguments[1]:!1,n=arguments.length>=3?arguments[2]:!1,c=this.findEvent(t),i=0,a=c.length;a>i;i++){r=c[i],f=[],p=r.__callbacks;for(s in p)o=p[s],e&&e!==o.callback||n&&n!==o.context||f.push(s);if(f.length===r.__callbacks.length)delete this.__events[r.name];else for(h=f.reverse(),l=0,u=h.length;u>l;l++)s=h[l],r.__callbacks.splice(s,1)}},t.prototype.triggerEvent=function(){var t,n,r,o,i,l,s,a,u,c,p,h;for(a=arguments[0],u=2<=arguments.length?e.call(arguments,1):[],"object"!=typeof a||a instanceof Array||(c=a,a=c.names,t=c.context),p=this.findEvent(a),o=0,l=p.length;l>o;o++)for(n=p[o],h=n.__callbacks,i=0,s=h.length;s>i;i++)r=h[i],r.listen&&(t&&t!==r.context||(++r.calls>=r.max&&null!=r.max&&(r.listen=!1),setTimeout(function(){this.callback.apply(this.context,u)}.bind(r),0)))},t.prototype.updateEvent=function(t,e){var n,r,o,i,l,s,a,u,c,p,h,f,g,d;for(null==e&&(e={}),o=e.context,h=e.max,d=e.reset,r=e.calls,p=e.listen,n=e.callback,d&&(r=0),f=this.findEvent(t),s=0,u=f.length;u>s;s++)for(i=f[s],g=i.__callbacks,a=0,c=g.length;c>a;a++)l=g[a],o&&o!==l.context||n&&n!==l.callback||(null!=h&&(l.max=h),null!=r&&(l.calls=r),null!=p&&(l.listen=p),null!=l.max&&l.max<=l.calls&&(l.listen=!1))},t.prototype.resetEvents=function(){return this.__events={}},t}(),t.Model=function(t){function e(t){var e;null==t&&(t=this.__base()),this.attributes=t;for(e in t)this.length++}var r;return n(e,t),e.prototype.__base=function(){return{}},e.prototype.length=0,r=function(t){var e,n,r,o;r=t.attributes,o=[];for(n in r)e=r[n],o.push(t.triggerEvent("changed:"+n,e));return o},e.prototype.init=function(){},e.prototype.set=function(t,e,n,r){var o,i,l,s,a,u,c;c=typeof t,"string"===c||"number"===c?((o={})[t]=e,t=o,e=n,r=[r]):r=n||[],l=this.__base(),a=0;for(u in t)i=t[u],null==this.attributes[u]&&this.length++,s=this["setter_"+u],l[u]=this.attributes[u]=null!=s?((null!=r[a]?r[a]:r[a]=[]).unshift(i),s.apply(this,r[a])):i,a++,e||this.triggerEvent("changed:"+u,l[u]);return e||this.triggerEvent("changed",l),this.length},e.prototype.get=function(t,e){var n,r,o,i,l,s,a,u,c;for(null==e&&(e=[]),t instanceof Array||(t=[t],e=[e]),r=this.__base(),c=r instanceof Array,l=a=0,u=t.length;u>a;l=++a)s=t[l],i=this["getter_"+s],n=this.attributes[s],o=null!=i?((null!=e[l]?e[l]:e[l]=[]).unshift(n),i.apply(this,e[l])):n,r[c?l:s]=o;return 1>=l&&(r=r[c?0:s]),r},e.prototype.remove=function(t,e){var n,o,i,l,s;for(t instanceof Array||(t=[t]),i=this.__base()instanceof Array,o=0,l=0,s=t.length;s>l;l++)n=t[l],i&&(n-=o),null!=this.attributes[n]&&(this.length--,i?this.attributes.splice(n,1):delete this.attributes[n],e||i||this.triggerEvent("changed:"+n),o++);return e||(i&&r(this),this.triggerEvent("changed")),this.length},e.prototype.has=function(t,e){var n,r,o;r=this.get(t,e),t instanceof Array||(r=[r]);for(o in r)if(n=r[o],void 0===n||null==n)return!1;return!0},e.prototype.same=function(t,e){var n,r;null==e&&(e=this.attributes);for(n in t)if(r=t[n],null==e[n]||r!==e[n])return!1;for(n in e)if(r=e[n],null==t[n]||r!==t[n])return!1;return!0},e.prototype.toString=function(){return this.attributes.toString()},e.prototype.toLocaleString=function(){return this.attributes.toLocaleString()},e.prototype.where=function(t){var e,n,r,o;r=this.attributes,o=[];for(n in r)e=r[n],e===t&&o.push(n);return o},e.prototype.reset=function(){this.length=0,this.attributes=this.__base(),this.triggerEvent("changed")},e.prototype["import"]=function(t,e){var n,r,o;null==e&&(e=!0);for(r in t)n=t[r],o=this.get(r),null!=(null!=o?o["import"]:void 0)?o["import"](n,e):(this.set(r,n,!0),e||this.triggerEvent("changed:"+r));e||this.triggerEvent("changed")},e.prototype["export"]=function(t){var e,n,r,o,i,l,s,a;s=this.__base(),null==t&&(t=function(){var t,e;t=this.attributes,e=[];for(o in t)r=t[o],e.push(o);return e}.call(this)),n=s instanceof Array;for(o in t)i=t[o],i instanceof Object&&(e=i.limit,i=i.name),l=Number(i),n&&!isNaN(l)&&(i=l),a=this.get(i),null!=a&&("function"==typeof a["export"]&&(a=a["export"](e)),n&&"number"==typeof i?s.push(a):s[i]=a);return s},e}(t.Events),t.View=function(e){function r(t){this.config=null!=t?t:{}}var o,i,l,s,a,u,c,p,h;return n(r,e),o=t.$,u=function(){var t;return this.config.name||(null!=(t=this.component)?t.name:void 0)||""},p=function(){var t;return this.config.parentName||(null!=(t=this.parent)?t.name:void 0)||""},l=function(){return this.config.attach||u.call(this)},h=function(){var t;return this.config.paths||(null!=(t=this.component)?t.paths:void 0)||[]},s=function(){var e,n,r,o,i;for(o=t.clone(h.call(this)),r=u.call(this),-1===o.indexOf(r)&&o.unshift(r),i=[],e=0,n=o.length;n>e;e++)r=o[e],i.push(r.replace(/[\/\\]+/g,"-"));return i},i=function(){var t;return null!=(t=this.config.async)?t:!0},c=function(){var t,e;return o(this.config.parentElement)[0]||(null!=(t=this.parent)&&null!=(e=t.view)?e.el:void 0)||document.documentElement},a=function(){var t,e;return null!=(t=this.config.data)?t:null!=(e=this.model)?e.attributes:void 0},r.prototype.init=function(){},r.prototype.ready=function(){},r.prototype.template=function(e){var n,r;return r=this.config.template,n=h.call(this),(r?t.request(n,r):t.request(n,"./template"))(e)},r.prototype.attach=function(t,e,n){var r,i,l,s,a,u,c;switch(null==n&&(n=this.config.method),e=o(e)[0],n){case"prefix":case"before":return t.insertBefore(e,t.firstChild),t.firstElementChild;case"replace":for(c=t.children,s=0,a=c.length;a>s;s++){l=c[s];try{t.removeChild(l)}catch(i){r=i}}return t.appendChild(e),t.firstElementChild;default:return isNaN(u=Number(n))?(t.appendChild(e),t.lastElementChild):(t.insertBefore(e,t.children[u]),t.children[u])}},r.prototype.isAttached=function(t,e){var n,r,i,l,s,a;if(e=o(e||document.documentElement),t=o(t||this.el),!e.length||!t.length)return!1;for(i=0,s=e.length;s>i;i++)for(r=e[i],l=0,a=t.length;a>l;l++)if(n=t[l],!o.contains(r,n))return!1;return!0},r.prototype.getAttachment=function(e){var n,r,i,s,a,u,c,h,f,g,d;if(e=o(e)[0]){for(s=o("[data-attach]",e).toArray(),e.getAttribute("data-attach")&&s.unshift(e),g=p.call(this),f=t.toAbsolute(g,l.call(this)),a=0,c=s.length;c>a;a++)if(i=s[a],!n)for(r=t.splitPaths(i.getAttribute("data-attach")||""),u=0,h=r.length;h>u;u++)if(d=r[u],f===t.toAbsolute(g,d)){n=i;break}return n}},r.prototype.render=function(t){var e;e=function(e){return function(){var n,r,i,l,u;return e.isAttached()&&!t?e.triggerEvent("rendered"):(u=c.call(e),r=e.config.element,n="static"===e.config.method?o(r)[0]:(i=r?o(r,u)[0]||o(r)[0]:(l=document.documentElement,e.getAttachment(u)||e.getAttachment(l)||u||l),e.attach(i,e.template(a.call(e)))),e.$el=o(n),e.el=e.$el[0],e.$el.addClass(s.call(e).join(" ")),t||e.triggerEvent("rendered"),void e.ready())}}(this),i.call(this)?setTimeout(e,0):e()},r.prototype.rerender=function(){this.clear(),this.render()},r.prototype.clear=function(t){null==t&&(t=this.el),o(t).remove()},r.prototype.element=function(t,e){var n,r,i,l;if(null==e&&(e=this.el),t instanceof Array){for(l=[],r=0,i=t.length;i>r;r++)n=t[r],l.push(o(n,e));return l}return o(t,e)},r}(t.Events),t.Controller=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.init=function(){},e}(t.Events),t.Collection=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var r;return n(e,t),e.prototype.__base=function(){return[]},r=function(t){var e,n,r;r=t.attributes;for(n in r)e=r[n],t.triggerEvent("changed:"+n,e);return t.triggerEvent("changed",t.attributes)},e.prototype.add=function(){var t;return t=Array.prototype.slice.call(arguments),t.unshift(this.length),this.set.apply(this,t)},e.prototype.at=function(){return this.get.apply(this,arguments)},e.prototype.push=function(){return this.add.apply(this,arguments)},e.prototype.splice=function(t,e,n,o,i){var l,s,a,u;null==n&&(n=[]),null==o&&(o=!1),null==i&&(i=[]),e>0&&this.remove(function(){u=[];for(var n=t,r=t+e-1;r>=t?r>=n:n>=r;r>=t?n++:n--)u.push(n);return u}.apply(this),!0),o instanceof Array&&(i=o,o=null!=i?i:!1),n instanceof Array||(n=[n]);for(s in n)l=n[s],this.length++,a=Number(s)+t,this.attributes.splice(a,0,0),this.set(a,l,!0,i[s]);return o||r(this),this.length},e.prototype.insert=function(t,e,n,r){return this.splice.call(this,t,0,e,n,r)},e.prototype.unshift=function(t,e,n){return this.splice.call(this,0,0,t,e,n)},e.prototype.pop=function(t){var e,n;return e=this.length-1,n=this.attributes[e],this.remove(e,t),n},e.prototype.shift=function(t){var e;return e=this.attributes[0],this.remove(0,t),e},e.prototype.reduce=function(t,e){return this.splice.call(this,0,t,[],e)},e.prototype.reduceRight=function(t,e){return this.splice.call(this,this.length-t,t,[],e)},e.prototype.concat=function(t,e,n){return this.splice.call(this,this.length,0,t,e,n)},e.prototype.every=function(){var t;return(t=this.attributes).every.apply(t,Array.prototype.slice.call(arguments))},e.prototype.filter=function(){var t;return(t=this.attributes).filter.apply(t,Array.prototype.slice.call(arguments))},e.prototype.forEach=function(){var t;return(t=this.attributes).forEach.apply(t,Array.prototype.slice.call(arguments))},e.prototype.indexOf=function(t,e){return this.attributes.indexOf(t,e)},e.prototype.join=function(){var t;return(t=this.attributes).join.apply(t,Array.prototype.slice.call(arguments))},e.prototype.lastIndexOf=function(t,e){return null==e&&(e=this.attributes.length-1),this.attributes.lastIndexOf(t,e)},e.prototype.map=function(){var t;return(t=this.attributes).map.apply(t,Array.prototype.slice.call(arguments))},e.prototype.reverse=function(t){var e;return e=this.attributes.reverse(),t||r(this),e},e.prototype.slice=function(t,e){return this.attributes.slice(t,e)},e.prototype.some=function(){var t;return(t=this.attributes).some.apply(t,Array.prototype.slice.call(arguments))},e.prototype.sort=function(t,e){var n,o;return"boolean"==typeof t&&(n=[t,e],e=n[0],t=n[1]),o=null!=t?this.attributes.sort(t):this.attributes.sort(),e||r(this),o},e}(t.Model),t.Component=function(){function n(e,n){var i,l,s,a,u,c,p,h,f,g;if(null==n)throw new Error("No options given");if(e=this.relation=e===window?{}:e,null==e.relation&&(e.relation={}),this.parent=e instanceof t.Component?e:e.component||e,this.root=this.parent.root||this,this.name=n.name,null==this.name)throw new Error("No name given");for(n.name=this.name=t.toAbsolute(this.parent.name||"",this.name),this.config=o.call(this,n),this.config.router&&r.call(this,"router",t.Router),this.config.collection&&r.call(this,"collection",t.Collection),r.call(this,"model",t.Model),r.call(this,"view",t.View),r.call(this,"controller",t.Controller),r.call(this,"components",t.Components),f=this.modules,i=0,s=f.length;s>i;i++)if(u=f[i],p=this[u])for(p.parent=this.parent,p.component=this,g=this.modules,l=0,a=g.length;a>l;l++)c=g[l],u!==c&&(h=this[c])&&(p[c]=h)}var r,o,i;return n.prototype.model=null,n.prototype.view=null,n.prototype.components=null,n.prototype.controller=null,n.prototype.router=null,n.prototype.modules=["router","components","collection","model","controller","view"],n.prototype.init=function(){var t,e,n,r,o;for(o=this.modules,e=0,n=o.length;n>e;e++)r=o[e],(t=this[r])&&"function"==typeof t.init&&t.init()},o=function(e){var n,r,o,i,l,s,a,u,c,p,h;for(r=[t.clone(e)],a=this.paths=[this.name],o=e["extends"]||this.name,s=(null!=(u=this.parent)?u.name:void 0)||this.name;o;)p=t.request(s,o+"/config",t.strict?null:{}),n=t.toAbsolute(s,o),-1===a.indexOf(n)&&a.push(n),r.push(t.clone(p)),o=p["extends"];for(h=r[r.length-1],i=l=c=r.length-1;0>=c?0>=l:l>=0;i=0>=c?++l:--l)h=t.combine(h,r[i]);return null==h.model&&(h.model={}),null==h.view&&(h.view={}),null==h.controller&&(h.controller={}),null==h.components&&(h.components=[]),h},r=function(e,n){var r,o;r=t.request(this.paths,"./"+e,n),o=this[e]=new r(this.config[e]),o.component=this,o.root=this.root,"function"==typeof o.__constructor&&o.__constructor()},i=function(t){this.view.addEvent(t+"ed",function(){return this.components.addEvent("ready",function(){return this.controller.triggerEvent("ready")},this,1),this.components[t]()},this,1),this.view[t]()},n.prototype.render=function(){i.call(this,"render")},n.prototype.rerender=function(){i.call(this,"rerender")},n.prototype.destroy=function(t){var e,n,r,o;if(this.view.clear(),e=this.relation.components,null!=e){o=e.data;for(r in o)n=o[r],n===this&&e.remove(r,t)}},n.prototype.findEvent=function(t,e){return this.controller.findEvent(t,e)},n.prototype.addEvent=function(t,e,n,r){return this.controller.addEvent(t,e,n,r)},n.prototype.removeEvent=function(t,e,n){return this.controller.removeEvent(t,e,n)},n.prototype.triggerEvent=function(){var t,n,r;return t=arguments[0],n=2<=arguments.length?e.call(arguments,1):[],(r=this.controller).triggerEvent.apply(r,[t].concat(e.call(n)))},n.prototype.updateEvent=function(t,e){return this.controller.updateEvent(t,e)},n.prototype.resetEvents=function(){return this.controller.resetEvents()},n.prototype["export"]=function(t){var e;return("function"==typeof(e=this.controller)["export"]?e["export"]():void 0)||{model:this.model["export"](t),components:this.components["export"]()}},n.prototype["import"]=function(t){return null!=this.controller["import"]?this.controller["import"](t):(t.model&&this.model["import"](t.model),t.components?this.components["import"](t.components):void 0)},n}(),t.Components=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var o;return n(r,e),r.prototype.__constructor=function(){var e,n,r,o,i,l,s,a,u,c,p,h,f,g,d,y,v,m,b,_,E,x,w,A;for(n=this.component.name,e=function(e){return t.toAbsolute(n,e)},o=function(n){var r,o,i,l,s;for(l=t.splitPaths(n),s=[],r=0,o=l.length;o>r;r++)i=l[r],s.push(e(i));return s},i=[],_=this.attributes,u=0,h=_.length;h>u;u++)if(a=_[u],a instanceof Array)for(r=e(a[1]),E=o(a[0]),c=0,f=E.length;f>c;c++)b=E[c],i.push(new t.Component(this,{name:b,"extends":r}));else if("string"==typeof a)for(x=o(a),p=0,g=x.length;g>p;p++)b=x[p],i.push(new t.Component(this,{name:b}));else if(!(a instanceof t.Component))for(a["extends"]=e(a["extends"]),w=o(a.name),v=0,d=w.length;d>v;v++)b=w[v],a.name=b,i.push(new t.Component(this,a));for(A=[],s=m=0,y=i.length;y>m;s=++m)l=i[s],A.push(this.set(s,l));return A},r.prototype.init=function(){var t,e,n,r;for(r=this.attributes,e=0,n=r.length;n>e;e++)t=r[e],t.init()},o=function(t){var e,n,r,o,i;if(0===this.length)this.triggerEvent("ready");else for(this.total=0,i=this.attributes,r=0,o=i.length;o>r;r++)n=i[r],e=n,n.controller.addEvent("ready",function(){return++this.total===this.length?this.triggerEvent("ready"):void 0},this,1),e[t]()},r.prototype.render=function(){o.call(this,"render")},r.prototype.rerender=function(){o.call(this,"rerender")},r.prototype.whereData=function(t,e){var n,r,o,i,l,s,a;a=[],r=this.attributes;for(n in r){o=r[n],l=o.model.data||model.data;for(i in l)s=l[i],i===t&&s===e&&a.push(o)}return a},r.prototype.reset=function(){var t,e,n,o;for(o=this.attributes,e=0,n=o.length;n>e;e++)t=o[e],t.destroy();r.__super__.reset.call(this)},r}(t.Collection),t.History=function(e){function r(){return this.changed=o(this.changed,this),r.__super__.constructor.apply(this,arguments)}var i,l,s,a,u,c,p,h,f,g,d,y,v,m,b,_,E;return n(r,e),_=!0,b=!1,u=null,g=50,v=!1,y="/",f=null,m=null,d=null,h=null,E=null,i=function(t){var e;return null==t&&(t=E),e=t.location.href.match(/#(.*)$/),e?e[1]:""},s=function(){var t;return t=d.href.replace(/#.*/,"").match(/\?.+/),t?t[0]:""},l=function(){var t,e;return e=decodeURI(""+d.pathname+s()),t=y.slice(0,-1),e.indexOf(t)||(e=e.slice(t.length)),"/"===e.charAt(0)?e.slice(1):e},a=function(t,e){var n;return null==t&&(_||e?(t=decodeURI(""+d.pathname+d.search),n=y.replace(/\/$/,""),t.indexOf(n)||(t=t.slice(n.length))):t=i()),t=t.replace(/^\/{2,}/g,"/"),t.match(/^\/+/)||(t="/"+t),t.replace(/\/+$/g,"")},c=function(t,e,n){f===t&&t.document.open().close(),n?t.location.replace(d.href.replace(/(javascript:|#).*$/,"")+"#"+e):t.location.hash=""+e},p=function(e){null==e&&(e="on"),_?t.$(E)[e]("popstate",this.changed):b&&(f?"on"===e?u=setInterval(this.changed,g):(clearInterval(u),document.body.removeChild(f.frameElement),f=u=null):t.$(E)[e]("hashchange",this.changed))},r.prototype.start=function(t){var e,n;return null==t&&(t={}),v?void 0:(v=!0,E=t.window||window,d=t.location||E.location,h=t.history||E.history,_=t.useHash?!1:null!=h?h.pushState:void 0,b=!_,(t.forceRefresh||b&&!("onhashchange"in E))&&(b=_=!1),g=t.interval||g,y=("/"+(t.root||"/")+"/").replace(/^\/+|\/+$/g,"/"),m=a(),b?d.replace(y+"#"+l()+i()):_&&""!==i()&&this.set(i(),{replace:!0}),_||b||t.forceRefresh||(n=document.createElement("iframe"),n.src="javascript:0",n.style.display="none",n.tabIndex=-1,e=document.body,f=e.insertBefore(n,e.firstChild).contentWindow,c(f,"#"+m,!1)),p.call(this),t.silent?void 0:this.triggerEvent("changed",m.replace(/^\/+/,"")))},r.prototype.stop=function(){return p.call(this,"off"),v=!1},r.prototype.set=function(t,e){var n,r,o;if(null==e&&(e={}),v&&(null==e.silent&&(e.silent=!0),o=e.replace,t=a(t)||"",n=y,(""===t||"?"===t.charAt(0))&&(n=n.slice(0,-1)||"/"),r=""+n+t.replace(/^\/*/,""),t=decodeURI(t.replace(/#.*$/,"")),m!==t)){if(m=t,_)h[o?"replaceState":"pushState"]({},document.title,r);else{if(!b)return void d.assign(fullURL);c(E,t,o),f&&t!==i(f)&&c(f,t,o)}e.silent||this.triggerEvent("changed",(m=t).replace(/^\/+/,""))}},r.prototype.changed=function(){var t,e;if(t=a(),e=m,t===e){if(!f)return!1;t=i(f),this.set(t)}return this.triggerEvent("changed",m=t),!0},r}(t.Events),t.History=new t.History,t.Router=function(e){function r(e){this.routes=null!=e?e:{},t.History.addEvent("changed",o,this)}var o,i,l,s,a,u,c;return n(r,e),r.prototype.add=function(t,e){null!=this.routes[t]?this.routes[t].push(e):this.routes[t]=[e]},r.prototype.remove=function(t,e){var n,r,o;o=this.routes[t],"string"==typeof e&&(e=(" "+e.replace(/\s+/g," ")+" ").split(" "));for(n in o)r=o[n],r===e&&delete o[n];this.routes[t]=o,null==o||null!=e&&0!==o.length||delete this.routes[t]},a=/\/?[?:]([^?\/:]*)/g,i=/[\-\\\^\[\]\s{}+.,$|#]/g,u=/\/?(\*)$/,s=function(t){var e,n,r,o,i,l,s;if(l=/^.*\?(.+)/.exec(t)){if(o=/([^&]+)&*/.exec(l[1]))for(s={},e=0,n=o.length;n>e;e++)r=o[e],(i=/(.+)[:=]+(.+)|(.+)/.exec(r))&&(s[i[3]||i[1]]=i[2]||"true")}else t&&(s=t.replace(/\?/g,""));return s},c=function(t){return t=t.replace(i,"\\$&"),t=t.replace(a,function(t){var e;return e="\\/?([^\\/]*?)",/^\/?\?/.exec(t)?"(?:"+e+")?":e}),t=t.replace(u,"\\/?(.*?)"),new RegExp("^"+t+"[\\/\\s]?$")},l=function(t){var e;return(e=t.match(a)||[]).push("splat"),e},o=function(t){var e,n,r,o,i,a,u,p,h,f,g,d,y,v;t=t.replace(/^\/+|\/+$/g,""),f=this.routes;for(e in f)for(v=f[e],r=0,u=v.length;u>r;r++)if(y=v[r],a=[],"string"==typeof y&&(a=l(y),y=c(y)),h=y.exec(t)){for(d={url:t,data:{}},h.splice(0,1),i=0,o=0,p=h.length;p>o;o++)n=h[o],d.data[(null!=(g=a[i])?g.replace(/^[?:\/]*/,""):void 0)||i]=s(n),i++;this.triggerEvent(e,d)}},r}(t.Events)}).call(this);
//# sourceMappingURL=lib/tweak.min.js.map